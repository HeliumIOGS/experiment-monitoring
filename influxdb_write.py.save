#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Thu Nov 19 11:36:28 2020

@author: jp

Python interface for influDB databases.

Takes a list of floats or ints and writes them into a specified inflluxDB
database.
"""

from influxdb import InfluxDBClient
from datetime import datetime


from eth_com import rcv_meas
from unit_conv import unit_conv

now = datetime.now()
dt_string = now.strftime("%d/%m/%Y %H:%M:%S")

analog_signals = rcv_meas()
output_list, write_to_db = unit_conv(analog_signals)

Nport = 8086

client = InfluxDBClient(host='localhost', port=8086, database='helium2
')


json_body = [
    {
        "measurement": output_list[0]['measurement'],
        "tags": {
            "unit": output_list[0]['unit'],
        },
        "time": dt_string,
        "fields": {
            "value": output_list[0]['value'],
            "raw": analog_signals[0],
        }
    }
]

if write_to_db is True:
    client.write_points(json_body)
